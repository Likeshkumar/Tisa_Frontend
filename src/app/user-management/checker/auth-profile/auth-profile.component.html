<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-custom-red">
                        <div class="row">
                            <div class="col-sm-9">
                                <h4 class="card-title">Authorize Profile Generation</h4>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" *ngIf="mode==='L'">
                        <div class="row">
                            <div class="col-sm-3">
                                <mat-form-field class="full-width">
                                    <mat-label>Search</mat-label>
                                    <input matInput (keyup)="applyFilter($event)" placeholder="Ex Username" #input>
                                </mat-form-field>
                            </div>
                        </div>
                        <br>
                        <div class="col-md-12 mat-elevation-z12">
                            <div class="example-container">
                                <table mat-table [dataSource]="dataSource">

                                    <ng-container matColumnDef="sno">
                                        <th mat-header-cell *matHeaderCellDef>Sl No</th>
                                        <td mat-cell *matCellDef="let row;let i = index"> {{i+1}} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="profileName">
                                        <th mat-header-cell *matHeaderCellDef> Profile Name </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.profileName }} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="profileDesc">
                                        <th mat-header-cell *matHeaderCellDef> Profile Description </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.profileDesc }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="actions">
                                        <th mat-header-cell *matHeaderCellDef>Action</th>
                                        <td mat-cell *matCellDef="let row">
                                            <button mat-icon-button aria-label="View" color="primary" matTooltip='View'
                                                (click)="showDetails(row, 'V')"><mat-icon>visibility</mat-icon></button>
                                            <button mat-icon-button aria-label="Authorize" color="text-secondary"
                                                matTooltip='Authorize' matTooltipClass="example-tooltip-red"
                                                (click)="showDetails(row, 'Auth')"><mat-icon>check_circle</mat-icon></button>
                                        </td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                    <tr class="mat-row" *matNoDataRow>
                                        <td class="mat-cell" colspan="9">No Records Found !!!!
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <mat-paginator [pageSizeOptions]="[5,10,15,20,50]" #paginatorRef showFirstLastButtons
                                aria-label="Select page of periodic elements">
                            </mat-paginator>
                        </div>

                    </div>

                    <div class="card-body" style="margin-top: 20px;margin-bottom: 50px;" *ngIf="mode!='L'">
                        <form [formGroup]="profileFormGroup" #desigForm="ngForm">
                            <div class="row">
                                <div class="col-lg-3 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Profile Name</mat-label>
                                        <input type="text" matInput autocomplete="off" maxlength="25"
                                            placeholder="Profile Name" formControlName="profileName" name="profileName"
                                            [readonly]="mode=='V' || mode=='Auth'">
                                    </mat-form-field>
                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Profile Description</mat-label>
                                        <input type="text" matInput autocomplete="off" maxlength="25"
                                            placeholder="Profile Description" formControlName="profileDesc"
                                            name="profileDesc" [readonly]="mode=='V' || mode=='Auth'">
                                    </mat-form-field>
                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Profile For</mat-label>
                                        <ng-container *ngIf="mode !== 'V' && mode !== 'Auth'; else readonlyInput">
                                            <mat-select formControlName="profileFor">
                                                <mat-option value="M">Maker</mat-option>
                                                <mat-option value="C">Checker</mat-option>
                                                <mat-option value="V">View</mat-option>
                                            </mat-select>
                                        </ng-container>
                                        <ng-template #readonlyInput>
                                            <input matInput
                                                [value]="getProfileForLabel(profileFormGroup.get('profileFor')?.value)"
                                                disabled>
                                        </ng-template>
                                    </mat-form-field>
                                </div>

                                <div class="col-lg-3 col-md-6 col-sm-12">
                                    <ng-container *ngIf="mode !== 'V' && mode !== 'Auth'; else readonlyBranchBased">
                                        <div class="d-flex flex-column">
                                            <mat-label class="mb-2">Branch Based Profile</mat-label>
                                            <mat-radio-group formControlName="branchBasedProfile" class="d-flex">
                                                <mat-radio-button value="Y" class="me-3">Yes</mat-radio-button>
                                                <mat-radio-button value="N">No</mat-radio-button>
                                            </mat-radio-group>
                                        </div>
                                    </ng-container>

                                    <ng-template #readonlyBranchBased>
                                        <mat-form-field class="full-width">
                                            <mat-label>Branch Based Profile</mat-label>
                                            <input matInput
                                                [value]="getBranchBasedLabel(profileFormGroup.get('branchBasedProfile')?.value)"
                                                readonly>
                                        </mat-form-field>
                                    </ng-template>
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-lg-3 col-md-3 col-sm-12"></div>
                                <div class="col-lg-6 col-md-6 col-sm-12">
                                    <h1>Select Menu</h1>
                                    <hr>

                                    <section class="example-section">
                                        <!-- Loop through the main menu items -->
                                        <div class="menu-item" *ngFor="let item of menuList; let i = index">
                                            <!-- Parent Checkbox -->
                                            <mat-checkbox class="example-margin" [(ngModel)]="item.checked"
                                                (change)="toggleParentSelection(item)"
                                                [ngModelOptions]="{ standalone: true }"
                                                [disabled]="mode === 'V' || mode=='Auth'">
                                                {{ item.name }}
                                            </mat-checkbox>

                                            <!-- Submenu Section -->
                                            <div *ngIf="item.subMenus && item.subMenus.length > 0"
                                                class="submenu-section">
                                                <ul>
                                                    <li *ngFor="let subitem of item.subMenus; let j = index">
                                                        <!-- Child Checkboxes -->
                                                        <mat-checkbox [(ngModel)]="subitem.checked"
                                                            (change)="updateParentSelection(item)"
                                                            [ngModelOptions]="{ standalone: true }"
                                                            [disabled]="mode === 'V' || mode=='Auth'">
                                                            {{ subitem.name }}
                                                        </mat-checkbox>
                                                    </li>
                                                </ul>
                                            </div>
                                        </div>
                                    </section>

                                </div>
                                <div class="col-lg-3 col-md-3 col-sm-12"></div>
                            </div>

                            <div class="text-end pb-3" *ngIf="mode=='V'" style="margin-bottom: 30px;">
                                <button mat-flat-button mat-dialog-close color="accent" (click)="close()">
                                    <mat-icon>keyboard_backspace</mat-icon> Back
                                </button> &nbsp; &nbsp; &nbsp;
                            </div>

                            <div class="d-flex justify-content-center" *ngIf="mode=='Auth'"
                                style="margin-bottom: 30px;">
                                <button mat-flat-button mat-dialog-close color="accent" (click)="close()">
                                    <mat-icon>keyboard_backspace</mat-icon> Back
                                </button> &nbsp; &nbsp; &nbsp;
                                <button mat-flat-button mat-dialog-close color="warn" (click)="reject()">
                                    <mat-icon>cancel</mat-icon> Reject
                                </button> &nbsp; &nbsp; &nbsp;
                                <button mat-flat-button mat-dialog-close color="primary" (click)="authorize()">
                                    <mat-icon>verified_user</mat-icon> Authorize
                                </button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>