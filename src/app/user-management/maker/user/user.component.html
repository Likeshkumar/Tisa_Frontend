<div class="main-content">
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header card-header-custom-red">
                        <div class="row">
                            <div class="col-sm-9">
                                <h4 class="card-title">User Generation</h4>
                            </div>
                        </div>
                    </div>
                    <div class="card-body" [hidden]="mode!='L'">
                        <div class="row">
                            <div class="col-sm-4">
                                <button mat-raised-button color="primary" class="btn" (click)="showDetails('Add', 'A')">
                                    <mat-icon>add</mat-icon>Add New User</button>
                            </div>
                            <div class="col-sm-5">
                            </div>
                            <div class="col-sm-3">
                                <mat-form-field class="full-width">
                                    <mat-label>Search</mat-label>
                                    <input matInput (keyup)="applyFilter($event)" placeholder="Ex Username" #input>
                                </mat-form-field>
                            </div>
                        </div>
                        <br>
                        <div class="col-md-12 mat-elevation-z12">
                            <div class="example-container">
                                <table mat-table [dataSource]="dataSource">

                                    <ng-container matColumnDef="sno">
                                        <th mat-header-cell *matHeaderCellDef>Sl No</th>
                                        <td mat-cell *matCellDef="let row;let i = index"> {{i+1}} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="userName">
                                        <th mat-header-cell *matHeaderCellDef> User Name </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.userName }} </td>
                                    </ng-container>

                                    <ng-container matColumnDef="profileId">
                                        <th mat-header-cell *matHeaderCellDef> Profile Name </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.profileName }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="branchCode">
                                        <th mat-header-cell *matHeaderCellDef> Branch Code </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.branchCode || 'N/A' }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="status">
                                        <th mat-header-cell *matHeaderCellDef> Status </th>
                                        <td mat-cell *matCellDef="let row">
                                            <span *ngIf="row.userBlock=='0'">Active</span>
                                            <span *ngIf="row.userBlock=='3'">Blocked</span>
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="addedDate">
                                        <th mat-header-cell *matHeaderCellDef> AddedDate </th>
                                        <td mat-cell *matCellDef="let row"> {{ row.addedDate | date: 'dd-MM-yyyy' }}
                                        </td>
                                    </ng-container>

                                    <ng-container matColumnDef="action">
                                        <th mat-header-cell *matHeaderCellDef>Action</th>
                                        <td mat-cell *matCellDef="let row">
                                            <button mat-icon-button aria-label="View" color="primary" matTooltip='View'
                                                (click)="showDetails(row,'V')"><mat-icon>visibility</mat-icon></button>
                                            <button mat-icon-button aria-label="Edit" color="text-secondary"
                                                matTooltip='Edit' matTooltipClass="example-tooltip-red"
                                                (click)="showDetails(row,'E')"><mat-icon>edit_note</mat-icon></button>
                                            <button mat-icon-button aria-label="Delete" color="accent"
                                                matTooltip='Delete' matTooltipClass="example-tooltip-red"
                                                (click)="deleteUser(row)"><mat-icon>delete</mat-icon></button>
                                        </td>
                                    </ng-container>

                                    <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                    <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                    <tr class="mat-row" *matNoDataRow>
                                        <td class="mat-cell" colspan="9">No Records Found !!!!
                                        </td>
                                    </tr>
                                </table>
                            </div>

                            <mat-paginator [pageSizeOptions]="[5,10,15,20,50]" #paginatorRef showFirstLastButtons
                                aria-label="Select page of periodic elements">
                            </mat-paginator>
                        </div>

                    </div>

                    <div class="card-body" style="margin-top: 20px;margin-bottom: 50px;" *ngIf="mode!='L'">
                        <form [formGroup]="userFormGroup" #desigForm="ngForm" class="p-2"
                            *ngIf="mode=='A' || mode=='E' || mode=='V'">
                            <div class="row">
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Profile Name</mat-label>
                                        <mat-select formControlName="profileName"
                                            (selectionChange)="onProfileChange($event.value)">
                                            <mat-option *ngFor="let profile of profileList"
                                                [value]="profile.profileName" [disabled]="mode === 'V'">
                                                {{ profile.profileName }}
                                            </mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div class="col-lg-4 col-md-6 col-sm-12" *ngIf="showBranchDropdown">
                                    <mat-form-field>
                                        <mat-label>Branch</mat-label>
                                        <mat-select formControlName="branchCode" [disabled]="mode === 'V'">
                                            <mat-option *ngFor="let branch of branchList" [value]="branch.branchCode">
                                                {{ branch.branchCode }} - {{ branch.branchName }}
                                            </mat-option>
                                            <mat-option *ngIf="branchList?.length === 0" disabled>No Records
                                                Found</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>User Name</mat-label>
                                        <input type="text" (keypress)="keyPressAlphaNumeric($event)" matInput
                                            autocomplete="off" placeholder="User Name" formControlName="userName"
                                            name="username" [readonly]="mode=='V'" minlength="4"
                                            maxlength="20">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>First Name</mat-label>
                                        <input type="text" matInput autocomplete="off" placeholder="First Name"
                                            formControlName="firstname" name="firstname" [readonly]="mode=='V'"
                                            maxlength="25">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Last Name</mat-label>
                                        <input type="text" matInput autocomplete="off" placeholder="Last Name"
                                            formControlName="lastname" name="lastname" [readonly]="mode=='V'"
                                            maxlength="25">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Email</mat-label>
                                        <input type="text" matInput autocomplete="off" placeholder="Email"
                                            formControlName="email" name="email" [readonly]="mode=='V'" maxlength="50">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Mobile No</mat-label>
                                        <input type="text" matInput autocomplete="off" maxlength='9'
                                            (keypress)="keyPressNumeric($event)" placeholder="Mobile"
                                            formControlName="mobile" name="mobile" [readonly]="mode=='V'">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Address</mat-label>
                                        <input type="text" matInput autocomplete="off" placeholder="address"
                                            formControlName="address" name="address" [readonly]="mode=='V'"
                                            maxlength="25">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>City</mat-label>
                                        <input type="text" matInput autocomplete="off" placeholder="city"
                                            formControlName="city" name="city" [readonly]="mode=='V'" maxlength="25">
                                    </mat-form-field>
                                </div>
                                <div class="col-lg-4 col-md-6 col-sm-12">
                                    <mat-form-field class="full-width">
                                        <mat-label>Country</mat-label>
                                        <mat-select formControlName="country" name="country" [disabled]="mode === 'V'">
                                            <mat-option value="CM">CM</mat-option>
                                        </mat-select>
                                    </mat-form-field>
                                </div>

                                <div class="text-end pb-3" *ngIf="mode=='A'">
                                    <button mat-flat-button mat-dialog-close color="accent" (click)="close()">
                                        <mat-icon>highlight_off</mat-icon> Cancel
                                    </button> &nbsp;
                                    <button mat-flat-button color="primary" (click)="addUser()" type="submit"
                                        [disabled]="!userFormGroup.valid">
                                        <mat-icon>check_circle_outline</mat-icon> Proceed
                                    </button>
                                </div>

                                <div class="text-end pb-3" *ngIf="mode=='E'">
                                    <button mat-flat-button mat-dialog-close color="accent" (click)="close()">
                                        <mat-icon>highlight_off</mat-icon> Cancel
                                    </button> &nbsp;
                                    <button mat-flat-button color="primary" (click)="updateUser()" type="submit"
                                        [disabled]="!userFormGroup.valid">
                                        <mat-icon>edit_note</mat-icon> Proceed
                                    </button>
                                </div>

                                <div class="text-end pb-3" *ngIf="mode=='V'">
                                    <button mat-flat-button mat-dialog-close color="accent" (click)="close()">
                                        <mat-icon>highlight_off</mat-icon> Close
                                    </button>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>